<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
<script type="text/javascript" src="http://dev.jtsage.com/cdn/spinbox/latest/jqm-spinbox.min.js"></script>
</head>
<body>

<style>

</style>

<script>
    var chosenItems = {};

    function gotoChooseQuantity(obj)
    {
        $.mobile.changePage("#chooseQuantity");
        itemsChosen = $(obj).text();
        $("#itemName").text(itemsChosen);
    }

    function save(obj)
    {
        $.mobile.changePage("#shoppingList");
        itemsChosen = $("#itemName").text();
        quantityChosen = $("#spin").val();
        $("#spin").val(1);
        chosenItems[itemsChosen] = quantityChosen;

        // save data locally
        localStorage.setItem(itemsChosen,quantityChosen);

    }

    function clearListView() {
      $("#savedItems").empty();
    }

    function gotoShowChosenItems()
    {
        
        // retrieve data from local storage and populate the local variable
        for (var i = 0; i < localStorage.length; i++) {
          chosenItems[localStorage.key(i)] = localStorage.getItem(localStorage.key(i));
        }

        $.mobile.changePage("#showChosenItems"); 

        // display list of chosen Items
        for (var key in chosenItems) {
            listData = key + " : " + chosenItems[key];
            $('<li>').append('<a href="#">' + listData + '</a></li>').appendTo('#savedList');            
            $("#savedList").listview("refresh");
        }
        //$("#allSavedItems").html(output);
    }

    function clearAllItems() {
      chosenItems = null;
      localStorage.clear();
      location.reload(); // refresh the current page     
    }

    function gotoItemsList() { // go back to page to add items
      $.mobile.changePage("#shoppingList");
      clearListView(); // empty the list to prevent duplicates
      location.reload();
    }

</script>


<div data-role="page" id="shoppingList">
  <div data-role="main" class="ui-content">
    <h2>Shopping List</h2>
    <button onclick="gotoShowChosenItems()">View Saved Items</button>
    <form class="ui-filterable">
      <input id="myFilter" data-type="search" placeholder="Search for items...">
    </form>
    <ul data-role="listview" data-filter="true" data-input="#myFilter" data-autodividers="true" data-inset="true">
      <li><a onclick="gotoChooseQuantity(this)">Apples</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Apricots</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Bananas</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Baking Powder</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Cake</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Chocolate</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Carrots</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Cream</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Caramel</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Dried Fruit</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Garlic</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Ham</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Raisins</a></li>
      <li><a onclick="gotoChooseQuantity(this)">Yoghurt</a></li>
    </ul>
  </div>
</div> 

<div data-role="page" id="chooseQuantity">
  <div data-role="main" class="ui-content">
    <div id="itemName"></div>
    <div class="ui-field-contain">
    <label for="spin"></label>
    <input type="text" data-role="spinbox" name="spin" id="spin" value="1" min="0" max="100" />
    </div>
    <button onclick="save()">Save</button>
    <button onclick="gotoShowChosenItems()">Show Chosen Items</button>
  </div>
</div>

<div data-role="page" id="showChosenItems">
  <div data-role="main" class="ui-content">
    <div id="allSavedItems">
      <ul data-role="listview" data-inset="true" id="savedList">
        <li><label><input type="checkbox" name="1" data-mini="true">TEST</label></li>
      </ul>
    </div>
    <button onclick="gotoItemsList()">Add More</button>
    <button onclick="clearAllItems()" style="background:darkred; color: white;">Clear All</button>
  </div>
</div>

</body>
</html>
